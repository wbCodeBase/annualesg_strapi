import{dT as Be,j as e,ev as O,a as I,B as A,T as f,cX as G,eG as re,du as U,eH as Oe,k as $,e as b,ac as xe,an as Ne,aY as je,r as F,aw as We,ax as Ue,al as be,x as ye,c5 as W,b2 as Fe,b3 as He,D,au as Ge,a3 as V,bf as _e,eI as qe,eJ as Qe,eK as Ye,eL as Ze,E as Je,O as Ke,o as Xe,q as ee,ag as Re,p as te,u as Me,eM as Ve,s as ve,eN as et,bu as tt,b as Ce,w as oe,eO as se,P as H,ap as Te,L as K,ae as st,bz as we,cK as _,aW as at,cv as Y,dH as nt,aa as De,ab as Se,G as ue,ad as it,eq as le,A as X,aZ as ze,eP as de,eQ as rt,eR as ot,am as ce,bl as lt,bm as dt,eS as ct,eT as ut,ed as gt,b4 as ht,J as mt,eU as pt,eV as ft,as as xt,at as jt,bp as q,bd as bt,bi as Q,eW as yt,eX as ne,eY as Rt,ee as Mt,g as vt,ba as Ct,eZ as Tt,R as wt,H as ge}from"./strapi-BOUicMrO.js";import{f as ie}from"./index-DD9_S4wU.js";import{t as Dt,a as St,R as zt,z as At}from"./schemas-yLBFZ4JA.js";import{f as It}from"./index-ByyWp821.js";import"./index-BRVyLNfZ.js";function Ae(t,s,r){var a=Dt(t,r),i=St(s,a,!0),n=new Date(a.getTime()-i),u=new Date(0);return u.setFullYear(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()),u.setHours(n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()),u}const Lt=$(b)`
  width: 100%;
  max-width: 256px;

  & > * {
    border-bottom: 1px solid ${({theme:t})=>t.colors.neutral150};
  }

  & > *:last-child {
    border-bottom: none;
  }
`,Et=({action:t,status:s,hasErrors:r,requiredStage:a,entryStage:i})=>{const{formatMessage:n}=I();return t==="publish"?r||a&&a.id!==i?.id?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(re,{fill:"danger600"}),endIcon:e.jsx(G,{}),children:e.jsx(f,{textColor:"danger600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.not-ready",defaultMessage:"Not ready to publish"})})})}):s==="draft"?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(G,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-publish",defaultMessage:"Ready to publish"})})})}):s==="modified"?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(Oe,{fill:"alternative600"}),endIcon:e.jsx(G,{}),children:e.jsx(f,{variant:"omega",fontWeight:"bold",textColor:"alternative600",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.modified",defaultMessage:"Ready to publish changes"})})})}):e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(G,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.already-published",defaultMessage:"Already published"})})})}):s==="published"?e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(G,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-unpublish",defaultMessage:"Ready to unpublish"})})})}):e.jsx(O.Trigger,{children:e.jsx(A,{variant:"ghost",startIcon:e.jsx(U,{fill:"success600"}),endIcon:e.jsx(G,{}),children:e.jsx(f,{textColor:"success600",variant:"omega",fontWeight:"bold",children:n({id:"content-releases.pages.ReleaseDetails.entry-validation.already-unpublished",defaultMessage:"Already unpublished"})})})})},Pt=({hasErrors:t,errors:s,kind:r,contentTypeUid:a,documentId:i,locale:n})=>{const{formatMessage:u}=I();return e.jsxs(b,{direction:"column",gap:1,width:"100%",padding:5,children:[e.jsxs(b,{gap:2,width:"100%",children:[e.jsx(f,{fontWeight:"bold",children:u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields",defaultMessage:"Fields"})}),t?e.jsx(re,{fill:"danger600"}):e.jsx(U,{fill:"success600"})]}),e.jsx(f,{width:"100%",textColor:"neutral600",children:t?u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.error",defaultMessage:"{errors} errors on fields."},{errors:s?Object.keys(s).length:0}):u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.success",defaultMessage:"All fields are filled correctly."})}),t&&e.jsx(xe,{tag:je,to:{pathname:`/content-manager/${r==="collectionType"?"collection-types":"single-types"}/${a}/${i}`,search:n?Ne.stringify({plugins:{i18n:{locale:n}}}):""},variant:"secondary",fullWidth:!0,state:{forceValidation:!0},children:u({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.see-errors",defaultMessage:"See errors"})})]})},$t=({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:r})=>t?s&&s.id!==r?.id?e.jsx(re,{fill:"danger600"}):e.jsx(U,{fill:"success600"}):e.jsx(U,{fill:"neutral200"}),kt=({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:r,formatMessage:a})=>t?s&&s.id!==r?.id?a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-ready",defaultMessage:"This entry is not at the required stage for publishing. ({stageName})"},{stageName:s?.name??""}):s&&s.id===r?.id?a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.ready",defaultMessage:"This entry is at the required stage for publishing. ({stageName})"},{stageName:s?.name??""}):a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.stage-not-required",defaultMessage:"No required stage for publication"}):a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-enabled",defaultMessage:"This entry is not associated to any workflow."}),Bt=({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:r})=>{const{formatMessage:a}=I(),i=$t({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:r});return e.jsxs(b,{direction:"column",gap:1,width:"100%",padding:5,children:[e.jsxs(b,{gap:2,width:"100%",children:[e.jsx(f,{fontWeight:"bold",children:a({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage",defaultMessage:"Review stage"})}),i]}),e.jsx(f,{textColor:"neutral600",children:kt({contentTypeHasReviewWorkflow:t,requiredStage:s,entryStage:r,formatMessage:a})})]})},Ot=({schema:t,entry:s,status:r,action:a})=>{const{validate:i,isLoading:n}=Be({collectionType:t?.kind??"",model:t?.uid??""},{skip:!0}),u=n?null:i(s),c=u?Object.keys(u).length>0:!1,p=t?.hasReviewWorkflow??!1,g=t?.stageRequiredToPublish,M=s.strapi_stage;return n?null:e.jsxs(O.Root,{children:[e.jsx(Et,{action:a,status:r,hasErrors:c,requiredStage:g,entryStage:M}),e.jsx(O.Content,{children:e.jsxs(Lt,{direction:"column",children:[e.jsx(Pt,{hasErrors:c,errors:u,contentTypeUid:t?.uid,kind:t?.kind,documentId:s.documentId,locale:s.locale}),e.jsx(Bt,{contentTypeHasReviewWorkflow:p,requiredStage:g,entryStage:M})]})})]})},Nt=["years","months","days","hours","minutes","seconds"],Ie=F.forwardRef(({timestamp:t,customIntervals:s=[],...r},a)=>{const{formatRelativeTime:i,formatDate:n,formatTime:u}=I(),c=We({start:t,end:Date.now()}),p=Nt.find(l=>c[l]>0&&Object.keys(c).includes(l)),g=Ue(t)?-c[p]:c[p],M=s.find(l=>c[l.unit]<l.threshold),C=M?M.text:i(g,p,{numeric:"auto"});return e.jsx("time",{ref:a,dateTime:t.toISOString(),role:"time",title:`${n(t)} ${u(t)}`,...r,children:C})}),Le=({handleClose:t,open:s,handleSubmit:r,initialValues:a,isLoading:i=!1})=>{const{formatMessage:n}=I(),{pathname:u}=be(),c=u===`/plugins/${Ye}`,{timezoneList:p,systemTimezone:g={value:"UTC+00:00-Africa/Abidjan "}}=ye(a.scheduledAt?new Date(a.scheduledAt):new Date),M=l=>{const{date:h,time:T,timezone:m}=l;if(!h||!T||!m)return null;const y=m.split("&")[1];return At(`${h} ${T}`,y)},C=()=>p.find(h=>h.value.split("&")[1]===a.timezone)?.value||g.value;return e.jsx(W.Root,{open:s,onOpenChange:t,children:e.jsxs(W.Content,{children:[e.jsx(W.Header,{children:e.jsx(W.Title,{children:n({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:c})})}),e.jsx(Fe,{onSubmit:l=>{r({...l,timezone:l.timezone?l.timezone.split("&")[1]:null,scheduledAt:l.isScheduled?M(l):null})},initialValues:{...a,timezone:a.timezone?C():g.value},validationSchema:zt,validateOnChange:!1,children:({values:l,errors:h,handleChange:T,setFieldValue:m})=>e.jsxs(He,{children:[e.jsx(W.Body,{children:e.jsxs(b,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(D.Root,{name:"name",error:h.name&&n({id:h.name,defaultMessage:h.name}),required:!0,children:[e.jsx(D.Label,{children:n({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"})}),e.jsx(Ge,{value:l.name,onChange:T}),e.jsx(D.Error,{})]}),e.jsx(V,{width:"max-content",children:e.jsx(_e,{name:"isScheduled",checked:l.isScheduled,onCheckedChange:y=>{m("isScheduled",y),y?(m("date",a.date),m("time",a.time),m("timezone",a.timezone??g?.value)):(m("date",null),m("time",""),m("timezone",null))},children:e.jsx(f,{textColor:l.isScheduled?"primary600":"neutral800",fontWeight:l.isScheduled?"semiBold":"regular",children:n({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),l.isScheduled&&e.jsxs(e.Fragment,{children:[e.jsxs(b,{gap:4,alignItems:"start",children:[e.jsx(V,{width:"100%",children:e.jsxs(D.Root,{name:"date",error:h.date&&n({id:h.date,defaultMessage:h.date}),required:!0,children:[e.jsx(D.Label,{children:n({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"})}),e.jsx(qe,{onChange:y=>{const w=y?It(y,{representation:"date"}):null;m("date",w)},clearLabel:n({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{m("date",null)},value:l.date?new Date(l.date):new Date,minDate:Ae(new Date,l.timezone.split("&")[1])}),e.jsx(D.Error,{})]})}),e.jsx(V,{width:"100%",children:e.jsxs(D.Root,{name:"time",error:h.time&&n({id:h.time,defaultMessage:h.time}),required:!0,children:[e.jsx(D.Label,{children:n({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"})}),e.jsx(Qe,{onChange:y=>{m("time",y)},clearLabel:n({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{m("time","")},value:l.time||void 0}),e.jsx(D.Error,{})]})})]}),e.jsx(Wt,{timezoneOptions:p})]})]})}),e.jsxs(W.Footer,{children:[e.jsx(W.Close,{children:e.jsx(A,{variant:"tertiary",name:"cancel",children:n({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(A,{name:"submit",loading:i,type:"submit",children:n({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:c})})]})]})})]})})},Wt=({timezoneOptions:t})=>{const{values:s,errors:r,setFieldValue:a}=Ze(),{formatMessage:i}=I(),[n,u]=F.useState(t);return F.useEffect(()=>{if(s.date){const{timezoneList:c}=ye(new Date(s.date));u(c);const p=s.timezone&&c.find(g=>g.value.split("&")[1]===s.timezone.split("&")[1]);p&&a("timezone",p.value)}},[a,s.date,s.timezone]),e.jsxs(D.Root,{name:"timezone",error:r.timezone&&i({id:r.timezone,defaultMessage:r.timezone}),required:!0,children:[e.jsx(D.Label,{children:i({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"})}),e.jsx(Je,{autocomplete:{type:"list",filter:"contains"},value:s.timezone||void 0,textValue:s.timezone?s.timezone.replace(/&/," "):void 0,onChange:c=>{a("timezone",c)},onTextValueChange:c=>{a("timezone",c)},onClear:()=>{a("timezone","")},children:n.map(c=>e.jsx(Ke,{value:c.value,children:c.value.replace(/&/," ")},c.value))}),e.jsx(D.Error,{})]})},Ut=Xe,Ee=t=>typeof t<"u"&&t.name!==void 0,Ft=$(we)`
  display: block;
`,Ht=$(Ie)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,Pe=t=>{let s;switch(t){case"ready":s="success";break;case"blocked":s="warning";break;case"failed":s="danger";break;case"done":s="primary";break;case"empty":default:s="neutral"}return{textColor:`${s}600`,backgroundColor:`${s}100`,borderColor:`${s}200`}},he=({sectionTitle:t,releases:s=[],isError:r=!1})=>{const{formatMessage:a}=I();return r?e.jsx(H.Error,{}):s?.length===0?e.jsx(De,{content:a({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:t}),icon:e.jsx(Se,{width:"16rem"})}):e.jsx(ue.Root,{gap:4,children:s.map(({id:i,name:n,scheduledAt:u,status:c})=>e.jsx(ue.Item,{col:3,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Ft,{tag:it,to:`${i}`,isExternal:!1,children:e.jsxs(b,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[e.jsxs(b,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(f,{textColor:"neutral800",tag:"h3",variant:"delta",fontWeight:"bold",children:n}),e.jsx(f,{variant:"pi",textColor:"neutral600",children:u?e.jsx(Ht,{timestamp:new Date(u)}):a({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),e.jsx(le,{...Pe(c),children:c})]})})},i))})},Gt=$(nt)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,_t={name:"",date:ie(new Date,"yyyy-MM-dd"),time:"",isScheduled:!0,scheduledAt:null,timezone:null},qt=()=>{const t=be(),[s,r]=F.useState(!1),{toggleNotification:a}=ee(),{formatMessage:i}=I(),n=Re(),{formatAPIError:u}=te(),[{query:c},p]=Me(),g=Ve(c),{data:M,isLoading:C}=ve(),[l,{isLoading:h}]=et(),{getFeature:T}=tt(),{maximumReleases:m=3}=T("cms-content-releases"),{trackUsage:y}=Ce(),{allowedActions:{canCreate:w}}=oe(se),{isLoading:L,isSuccess:S,isError:d}=g,N=g?.currentData?.meta?.activeTab||"pending";F.useEffect(()=>{t?.state?.errors&&(a({type:"danger",title:i({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:i({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),n("",{replace:!0,state:null}))},[i,t?.state?.errors,n,a]);const v=()=>{r(z=>!z)};if(L||C)return e.jsx(H.Loading,{});const R=S&&g.currentData?.meta?.pendingReleasesCount||0,k=R>=m,B=z=>{p({...c,page:1,pageSize:g?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:z!=="pending"}}})},E=async({name:z,scheduledAt:o,timezone:x})=>{const j=await l({name:z,scheduledAt:o,timezone:x});"data"in j?(a({type:"success",message:i({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),y("didCreateRelease"),n(j.data.data.id.toString())):X(j.error)?a({type:"danger",message:u(j.error)}):a({type:"danger",message:i({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(Te,{"aria-busy":L||C,children:[e.jsx(K.Header,{title:i({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),subtitle:i({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:w?e.jsx(A,{startIcon:e.jsx(st,{}),onClick:v,disabled:k,children:i({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})}):null}),e.jsx(K.Content,{children:e.jsxs(e.Fragment,{children:[k&&e.jsx(Gt,{marginBottom:6,action:e.jsx(we,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:i({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:i({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:m}),onClose:()=>{},closeLabel:"",children:i({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),e.jsxs(_.Root,{variant:"simple",onValueChange:B,value:N,children:[e.jsxs(V,{paddingBottom:8,children:[e.jsxs(_.List,{"aria-label":i({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),children:[e.jsx(_.Trigger,{value:"pending",children:i({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:R})}),e.jsx(_.Trigger,{value:"done",children:i({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),e.jsx(at,{})]}),e.jsx(_.Content,{value:"pending",children:e.jsx(he,{sectionTitle:"pending",releases:g?.currentData?.data,isError:d})}),e.jsx(_.Content,{value:"done",children:e.jsx(he,{sectionTitle:"done",releases:g?.currentData?.data,isError:d})})]}),e.jsxs(Y.Root,{...g?.currentData?.meta?.pagination,defaultPageSize:g?.currentData?.meta?.pagination?.pageSize,children:[e.jsx(Y.PageSize,{options:["8","16","32","64"]}),e.jsx(Y.Links,{})]})]})}),e.jsx(Le,{open:s,handleClose:v,handleSubmit:E,isLoading:h,initialValues:{..._t,timezone:M?.data.defaultTimezone?M.data.defaultTimezone.split("&")[1]:null}})]})},Qt=$(b)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:t})=>t.borderRadius};
  border-bottom-left-radius: ${({theme:t})=>t.borderRadius};
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,me=$(Mt)`
  svg path {
    fill: ${({theme:t,disabled:s})=>s&&t.colors.neutral500};
  }
  span {
    color: ${({theme:t,disabled:s})=>s&&t.colors.neutral500};
  }

  &:hover {
    background: ${({theme:t,$variant:s="neutral"})=>t.colors[`${s}100`]};
  }
`,Yt=$(vt)`
  width: ${({theme:t})=>t.spaces[4]};
  height: ${({theme:t})=>t.spaces[4]};
  path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,Zt=$(Ct)`
  width: ${({theme:t})=>t.spaces[4]};
  height: ${({theme:t})=>t.spaces[4]};
  path {
    fill: ${({theme:t})=>t.colors.danger600};
  }
`,pe=({toggleEditReleaseModal:t,toggleWarningSubmit:s,children:r})=>{const{formatMessage:a,formatDate:i,formatTime:n}=I(),{releaseId:u}=ze(),{data:c,isLoading:p,error:g}=de({id:u},{skip:!u}),[M,{isLoading:C}]=ct(),{toggleNotification:l}=ee(),{formatAPIError:h}=te(),{allowedActions:T}=oe(se),{canUpdate:m,canDelete:y,canPublish:w}=T,L=Ut(),{trackUsage:S}=Ce(),d=c?.data,N=x=>async()=>{const j=await M({id:x});if("data"in j){l({type:"success",message:a({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})});const{totalEntries:P,totalPublishedEntries:Z,totalUnpublishedEntries:J}=j.data.meta;S("didPublishRelease",{totalEntries:P,totalPublishedEntries:Z,totalUnpublishedEntries:J})}else X(j.error)?l({type:"danger",message:h(j.error)}):l({type:"danger",message:a({id:"notification.error",defaultMessage:"An error occurred"})})},v=()=>{L(Tt.util.invalidateTags([{type:"ReleaseAction",id:"LIST"},{type:"Release",id:u}]))},R=()=>d?.createdBy?d.createdBy.username?d.createdBy.username:d.createdBy.firstname?`${d.createdBy.firstname} ${d.createdBy.lastname||""}`.trim():d.createdBy.email:null;if(p)return e.jsx(H.Loading,{});if(Ee(g)&&"code"in g||!d)return e.jsx(ce,{to:"..",state:{errors:[{code:g?.code}]}});const k=d.actions.meta.count||0,B=!!R(),E=d.scheduledAt&&d.timezone,z=a({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:k}),o=E?a({id:"content-releases.pages.ReleaseDetails.header-subtitle.scheduled",defaultMessage:"Scheduled for {date} at {time} ({offset})"},{date:i(new Date(d.scheduledAt),{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:d.timezone}),time:n(new Date(d.scheduledAt),{timeZone:d.timezone,hourCycle:"h23"}),offset:ut(d.timezone,new Date(d.scheduledAt))}):"";return e.jsxs(Te,{"aria-busy":p,children:[e.jsx(K.Header,{title:d.name,subtitle:e.jsxs(b,{gap:2,lineHeight:6,children:[e.jsx(f,{textColor:"neutral600",variant:"epsilon",children:z+(E?` - ${o}`:"")}),e.jsx(le,{...Pe(d.status),children:d.status})]}),navigationAction:e.jsx(ht,{fallback:".."}),primaryAction:!d.releasedAt&&e.jsxs(b,{gap:2,children:[e.jsxs(Jt,{label:e.jsx(gt,{}),variant:"tertiary",endIcon:null,paddingLeft:"7px",paddingRight:"7px","aria-label":a({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release edit and delete menu"}),popoverPlacement:"bottom-end",children:[e.jsx(me,{disabled:!m,onSelect:t,children:e.jsxs(b,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[e.jsx(Yt,{}),e.jsx(f,{ellipsis:!0,children:a({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})})]})}),e.jsx(me,{disabled:!y,onSelect:s,$variant:"danger",children:e.jsxs(b,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[e.jsx(Zt,{}),e.jsx(f,{ellipsis:!0,textColor:"danger600",children:a({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})})]})}),e.jsxs(Qt,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:4,children:[e.jsx(f,{variant:"pi",fontWeight:"bold",children:a({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),e.jsxs(f,{variant:"pi",color:"neutral300",children:[e.jsx(Ie,{timestamp:new Date(d.createdAt)}),a({id:"content-releases.header.actions.created.description",defaultMessage:"{hasCreatedByUser, select, true { by {createdBy}} other { by deleted user}}"},{createdBy:R(),hasCreatedByUser:B})]})]})]}),e.jsx(A,{size:"S",variant:"tertiary",onClick:v,children:a({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),w?e.jsx(A,{size:"S",variant:"default",onClick:N(d.id.toString()),loading:C,disabled:d.actions.meta.count===0,children:a({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})}):null]})}),r]})},Jt=$(Rt)`
  & > span {
    display: flex;
  }
`,Kt=["contentType","locale","action"],Xt=["contentType","action"],fe=t=>t==="locale"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.locales",defaultMessage:"Locales"}:t==="action"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.actions",defaultMessage:"Actions"}:{id:"content-releases.pages.ReleaseDetails.groupBy.option.content-type",defaultMessage:"Content-Types"},Vt=({releaseId:t})=>{const{formatMessage:s}=I(),[{query:r},a]=Me(),{toggleNotification:i}=ee(),{formatAPIError:n}=te(),{data:u,isLoading:c,error:p}=de({id:t}),{allowedActions:{canUpdate:g}}=oe(se),M=mt("ReleaseDetailsPage",o=>o.runHookWaterfall),{displayedHeaders:C,hasI18nEnabled:l}=M("ContentReleases/pages/ReleaseDetails/add-locale-in-releases",{displayedHeaders:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"},name:"name"}],hasI18nEnabled:!1}),h=u?.data,T=r?.groupBy||"contentType",{isLoading:m,isFetching:y,isError:w,data:L,error:S}=pt({...r,releaseId:t}),[d]=ft(),N=async(o,x,j)=>{const P=await d({params:{releaseId:t,actionId:x},body:{type:o.target.value},query:r,actionPath:j});"error"in P&&(X(P.error)?i({type:"danger",message:n(P.error)}):i({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})}))};if(m||c)return e.jsx(H.Loading,{});const v=L?.data,R=L?.meta,k=R?.contentTypes||{};if(R?.components,Ee(p)||!h){const o=[];return p&&"code"in p&&o.push({code:p.code}),S&&"code"in S&&o.push({code:S.code}),e.jsx(ce,{to:"..",state:{errors:o}})}if(w||!v)return e.jsx(H.Error,{});if(Object.keys(v).length===0)return e.jsx(K.Content,{children:e.jsx(De,{action:e.jsx(xe,{tag:je,to:{pathname:"/content-manager"},style:{textDecoration:"none"},variant:"secondary",children:s({id:"content-releases.page.Details.button.openContentManager",defaultMessage:"Open the Content Manager"})}),icon:e.jsx(Se,{width:"16rem"}),content:s({id:"content-releases.pages.Details.tab.emptyEntries",defaultMessage:"This release is empty. Open the Content Manager, select an entry and add it to the release."})})});const B=s({id:"content-releases.pages.ReleaseDetails.groupBy.aria-label",defaultMessage:"Group by"}),E=[...C,{label:{id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"},name:"content-type"},{label:{id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"},name:"action"},...h.releasedAt?[]:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.status",defaultMessage:"status"},name:"status"}]],z=l?Kt:Xt;return e.jsx(K.Content,{children:e.jsxs(b,{gap:8,direction:"column",alignItems:"stretch",children:[e.jsx(b,{children:e.jsx(xt,{placeholder:B,"aria-label":B,customizeContent:o=>s({id:"content-releases.pages.ReleaseDetails.groupBy.label",defaultMessage:"Group by {groupBy}"},{groupBy:o}),value:s(fe(T)),onChange:o=>a({groupBy:o}),children:z.map(o=>e.jsx(jt,{value:o,children:s(fe(o))},o))})}),Object.keys(v).map(o=>e.jsxs(b,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsx(b,{role:"separator","aria-label":o,children:e.jsx(le,{children:o})}),e.jsx(q.Root,{rows:v[o].map(x=>({...x,id:Number(x.entry.id)})),headers:E,isLoading:m||y,children:e.jsxs(q.Content,{children:[e.jsx(q.Head,{children:E.map(({label:x,name:j})=>e.jsx(q.HeaderCell,{label:s(x),name:j},j))}),e.jsx(q.Loading,{}),e.jsx(q.Body,{children:v[o].map(({id:x,contentType:j,locale:P,type:Z,entry:J,status:$e},ke)=>e.jsxs(bt,{children:[e.jsx(Q,{width:"25%",maxWidth:"200px",children:e.jsx(f,{ellipsis:!0,children:`${j.mainFieldValue||J.id}`})}),l&&e.jsx(Q,{width:"10%",children:e.jsx(f,{children:`${P?.name?P.name:"-"}`})}),e.jsx(Q,{width:"10%",children:e.jsx(f,{children:j.displayName||""})}),e.jsx(Q,{width:"20%",children:h.releasedAt?e.jsx(f,{children:s({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:Z==="publish",b:ae=>e.jsx(f,{fontWeight:"bold",children:ae})})}):e.jsx(yt,{selected:Z,handleChange:ae=>N(ae,x,[o,ke]),name:`release-action-${x}-type`,disabled:!g})}),!h.releasedAt&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{width:"20%",minWidth:"200px",children:e.jsx(Ot,{action:Z,schema:k?.[j.uid],entry:J,status:$e})}),e.jsx(Q,{children:e.jsx(b,{justifyContent:"flex-end",children:e.jsxs(ne.Root,{children:[e.jsx(ne.ReleaseActionEntryLinkItem,{contentTypeUid:j.uid,documentId:J.documentId,locale:P?.code}),e.jsx(ne.DeleteReleaseActionItem,{releaseId:h.id,actionId:x})]})})})]})]},x))})]})})]},`releases-group-${o}`)),e.jsxs(Y.Root,{...R?.pagination,defaultPageSize:R?.pagination?.pageSize,children:[e.jsx(Y.PageSize,{}),e.jsx(Y.Links,{})]})]})})},es=()=>{const{formatMessage:t}=I(),{releaseId:s}=ze(),{toggleNotification:r}=ee(),{formatAPIError:a}=te(),i=Re(),[n,u]=F.useState(!1),[c,p]=F.useState(!1),{isLoading:g,data:M,isSuccess:C}=de({id:s},{skip:!s}),{data:l,isLoading:h}=ve(),[T,{isLoading:m}]=rt(),[y]=ot(),w=()=>{u(o=>!o)},L=()=>d?.timezone?d.timezone:l?.data.defaultTimezone?l.data.defaultTimezone:null,S=()=>p(o=>!o);if(g||h)return e.jsx(pe,{toggleEditReleaseModal:w,toggleWarningSubmit:S,children:e.jsx(H.Loading,{})});if(!s)return e.jsx(ce,{to:".."});const d=C&&M?.data||null,N=d?.name||"",v=L(),R=d?.scheduledAt&&v?Ae(d.scheduledAt,v):null,k=R?ie(R,"yyyy-MM-dd"):void 0,B=R?ie(R,"HH:mm"):"",E=async o=>{const x=await T({id:s,name:o.name,scheduledAt:o.scheduledAt,timezone:o.timezone});"data"in x?(r({type:"success",message:t({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}),w()):X(x.error)?r({type:"danger",message:a(x.error)}):r({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})},z=async()=>{const o=await y({id:s});"data"in o?i(".."):X(o.error)?r({type:"danger",message:a(o.error)}):r({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(pe,{toggleEditReleaseModal:w,toggleWarningSubmit:S,children:[e.jsx(Vt,{releaseId:s}),e.jsx(Le,{open:n,handleClose:w,handleSubmit:E,isLoading:g||m,initialValues:{name:N||"",scheduledAt:R,date:k,time:B,isScheduled:!!R,timezone:v}}),e.jsx(lt.Root,{open:c,onOpenChange:S,children:e.jsx(dt,{onConfirm:z,children:t({id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"})})})]})},rs=()=>e.jsx(H.Protect,{permissions:se.main,children:e.jsxs(wt,{children:[e.jsx(ge,{index:!0,element:e.jsx(qt,{})}),e.jsx(ge,{path:":releaseId",element:e.jsx(es,{})})]})});export{rs as App};
